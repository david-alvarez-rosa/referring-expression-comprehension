% -*- TeX-master: "Thesis.tex" -*-


\RequirePackage[l2tabu, orthodox]{nag}
\documentclass[11pt]{book}


\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern, fix-cm}
\usepackage[main=english, spanish, catalan]{babel}
\usepackage{geometry}
\usepackage{amsmath, amsthm, amssymb, mathtools}
\usepackage{bm}
\usepackage{graphicx, float}
\usepackage[cmyk, dvipsnames, table]{xcolor}
\usepackage{microtype}
\usepackage{emptypage}
\usepackage{fancyhdr}
\usepackage{lettrine}
\usepackage{booktabs}
\usepackage{caption, subcaption}
\usepackage[nottoc]{tocbibind}
\usepackage[bottom, marginal, norule]{footmisc}
\usepackage[type={CC}, modifier={by-nc-sa}, version={4.0}]{doclicense}
\usepackage[backend=biber, style=alphabetic]{biblatex}
\usepackage{imakeidx}
\usepackage{epigraph}
\usepackage{siunitx}
\usepackage{tikz, pgfplots}
\usepackage{fontawesome}
\usepackage[outputdir=Build, cachedir=Minted]{minted}
\usepackage[most]{tcolorbox}
\usepackage{hyperxmp}
\usepackage{svg}
\usepackage{varioref}
\usepackage[pdfusetitle]{hyperref}
\usepackage[nomain, acronym, style=super3col]{glossaries}
\usepackage[noabbrev]{cleveref}


% Fallback to computer modern for sc + bf.
\rmfamily
\DeclareFontShape{T1}{lmr}{b}{sc}{<->ssub*cmr/bx/sc}{}
\DeclareFontShape{T1}{lmr}{bx}{sc}{<->ssub*cmr/bx/sc}{}

% % Customize page layout.
\geometry{
  paper = b5paper,
  top = 1in,
  bottom = .875in,
  inner = .75in,
  outer = .75in,
  bindingoffset = .25in,
  % showframe
}

% Customize captions for floating elements.
\captionsetup{
  font = small,
  labelfont = {sc, bf},
  labelsep = period,
  width = .75\textwidth,
}
% \captionsetup[sub]{
%   list,
%   listformat = simple,
% }

\hypersetup{
  % Info.
  pdfsubject = {Computer Vision},
  pdfkeywords = {Artificial Intelligence, Machine Learning, Computer Vision,
    Multimodal Learning},
  % Colors.
  colorlinks,
  % hidelinks,
  linkcolor = blue,
  citecolor = magenta,
  urlcolor = red!50!black,
  % For ToC.
  % linktoc = all,
  % Displaying.
  pdfpagelayout = TwoPageRight,
  pdfstartview = FitV,
  pdfpagemode = UseOutlines,
  bookmarksopen,
  bookmarksnumbered,
  breaklinks,
  % Write both PDF Info dictionary and XMP packet (from hyperxmp package).
  keeppdfinfo,
}

% Configure running headers and footers.
\pagestyle{fancy}
\fancyhead[RO,LE]{\small\bfseries\thepage}
\fancyhead[RE]{\small\slshape\leftmark}
\fancyhead[LO]{\small\slshape\rightmark}
\fancyfoot{}
\makeatletter
\fancyfoot[CO]{\scshape\@author}
\makeatother
\fancyfoot[CE]{\scshape\shortTitle}
\renewcommand{\footrulewidth}{.4pt}
\fancypagestyle{plain}{
  \fancyhf{}
  \fancyfoot[C]{\small\thepage}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}
% Really ugly stuff.
% https://tex.stackexchange.com/questions/125457/changing-chapter-page-footer-with-epigraph
\makeatletter
\renewcommand{\epigraphhead}[2][95]{%
  \def\@epitemp{\begin{minipage}{\epigraphwidth}#2\end{minipage}}
  \def\ps@epigraph{\let\@mkboth\@gobbletwo
    \@epipos
    \if@epirhs
    \def\@oddhead{\hfil\begin{picture}(0,0)
        \put(0,-#1){\makebox(0,0)[r]{\@epitemp}}
      \end{picture}}
    \else
    \if@epicenter
    \def\@oddhead{\hfil\begin{picture}(0,0)
        \put(0,-#1){\makebox(0,0)[b]{\@epitemp}}
      \end{picture}\hfil}
    \else
    \def\@oddhead{\begin{picture}(0,0)
        \put(0,-#1){\makebox(0,0)[l]{\@epitemp}}
      \end{picture}\hfil}
    \fi
    \fi
    \let\@evenhead\@oddhead
    \def\@oddfoot{\reset@font\hfil\small\thepage\hfil}
    \let\@evenfoot\@oddfoot}
  \thispagestyle{epigraph}}
\makeatother

% Set path for figures (relative to main document).
\graphicspath{{./Figures/}}

% Glosary configuration.
\setupglossaries{
  toc,
  shortcuts,
  ucmark
}
\makeglossaries
\input{Acronyms}
\renewcommand{\glsnamefont}[1]{\textbf{#1}}
\setlength\glspagelistwidth{.25\textwidth}
\setlength\glsdescwidth{.5\textwidth}
\preto\chapter{\glsresetall}

% Alphabetical index customization.
\makeindex[columns=2, intoc, options={-s Index.ist}]

% Epigraph configuration.
\setlength\epigraphwidth{.55\textwidth}
\renewcommand{\textflush}{flushright}
\setlength\epigraphrule{0pt}

% Set the label symbols (taken from spanish babel package).
\makeatletter
\renewcommand{\labelitemi}{%
  \leavevmode\hbox to 1.2ex{\hss\vrule height .9ex width .7ex depth -.2ex\hss}%
}
\renewcommand{\labelitemii}{\textbullet}
\renewcommand{\labelitemiii}{$\m@th\circ$}
\renewcommand{\labelitemiv}{$\m@th\diamond$}
\makeatother

% Footnote configuration.
% \setlength\footnotemargin{-1.25em} TODO. check this or remove it.

% Add command for footnote href.
\newcommand\fhref[2]{
  \href{#1}{#2}\footnote{Full link for ``#2'': \url{#1}}
}

% Customize bibliography (biblatex and biber).
\addbibresource{References.bib}
\ExecuteBibliographyOptions{minnames=5, maxnames=5}
\DeclareFieldFormat{annotation}{\par\nobreak\vskip\bibitemsep #1\smallskip}
\renewbibmacro*{finentry}{\printfield{annotation}\finentry}
\DeclareFieldFormat{labelalphawidth}{\mkbibbold{#1}}
% \DeclareFieldFormat{labelalphawidth}{\mkbibbrackets{\mkbibbold{#1}}}
\renewcommand{\mkbibnamefamily}[1]{\textsc{#1}}
\renewcommand{\mkbibnamegiven}[1]{\textsc{#1}}
\renewcommand{\mkbibnameprefix}[1]{\textsc{#1}}
\renewcommand{\mkbibnamesuffix}[1]{\textsc{#1}}

% Set minted style and font for line numbers.
\usemintedstyle{tango}
\renewcommand{\theFancyVerbLine}{
  \ttfamily\scriptsize\arabic{FancyVerbLine}
}

% Tikz configuration.
\usetikzlibrary{
  external,
  positioning,
  arrows,
  shadows.blur,
  calc,
  shapes.geometric
}
\tikzexternalize[prefix=Build/Tikz/, figure name=Figure]
\tikzset{
  linum/.style = {
    fill = black!25,
    draw = black
  },
  codeSymbol/.style = {
    white,
    circle,
    anchor = north east,
    outer sep = -9pt,
    fill = black,
  },
  quoteDecoration/.style = {
    draw = tcbcolframe,
    fill = tcbcolback!80!black,
    line width = .5mm,
  },
  myPlot/.style = {
    smooth,
    ultra thick,
    blue,
    samples = 200
  }
}

% Pgfplots configuration.
\pgfplotsset{compat=newest}
\pgfplotsset{%
  activationFunction/.style = {%
    xlabel = {$x$}, ylabel = {$y$},
    legend style = {
      at = {(0.5, 1.05)},
      anchor = south,
    },
    grid = both,
    xtick distance = 1, ytick distance = 1,
    minor tick num = 1,
    major grid style = {thin, dashed, gray!60},
    minor grid style = {thin, dashed, gray!20},
    axis lines = center,
    axis line style = {
      very thick,
      -latex
    },
    enlargelimits,
    width = \textwidth,
    scale only axis,
  }
}

% Tcolorbox configuration.
\tcbuselibrary{listings}
\tcbuselibrary{minted}
% Basic reusable styles.
\tcbset{
  indentFix/.style = {
    before upper={\parindent17pt\noindent}
  },
  baseBox/.style = {
    indentFix,
    enhanced,
    lower separated = false,
    breakable,
    boxrule = 0.5mm,
    boxsep = 0pt,
    left = \parindent-0.5mm,
    right = \parindent-0.5mm,
    bottom = 3mm,
    top = 3mm,
    % before skip = .75em,
    % after skip = 1em,
    % left = 3mm,
    % right = 4mm,
    % top = 1mm,
    % bottom = 2mm,
    middle = 1mm,
    sharp corners,
    drop fuzzy shadow,
    rounded corners = southeast,
    arc is angular,
    arc = 3mm,
    underlay unbroken and last = {
      \path[quoteDecoration] ([shift={(.01, .3)}]interior.south east) --
      ++(-.4, -.1) -- ++(.1, -.2);
    },
  }
}
\tcbsetforeverylayer{shield externalize}
% Quote box.
\newtcolorbox{quoteBox}{
  baseBox,
  colback = RoyalBlue!10,
  colframe = RoyalBlue!50!black,
  fontupper=\itshape,
  fontlower=\small,
  before lower = \hfill---,
  leftrule = 5pt,
  left = \parindent-5pt,
}
% Example box.
\newtcolorbox{exampleBox}{
  baseBox,
  colback = OliveGreen!10,
  colframe = OliveGreen!50!black
}
% Remark box.
\newtcolorbox{remarkBox}{
  baseBox,
  colback = Red!10,
  colframe = BrickRed!90!black,
  underlay = {
    \path[fill=tcbcolframe] ([shift={(-0.5mm,-0.5mm)}]interior.south west)
    rectangle node[white]{\Huge\bfseries !}
    ([shift={(3.5mm,0.5mm)}]interior.north west);
    }
}

% Input code file.
\newtcbinputlisting[auto counter, number within=chapter, list inside=code]{\codeLst}[4]{
  listing engine = minted,
  minted language = #1,
  listing file = {#2},
  minted options = {
    autogobble,
    linenos,
    numbersep = 8pt,
    breaklines,
    % breaksymbol = {},
    fontfamily = tt,
    fontsize = \footnotesize,
    mathescape = true,
    samepage = false,
  },
  enhanced,
  listing only,
  drop fuzzy shadow,
  breakable,
  sharp corners,
  colbacktitle = Gray!50!black,
  colback = Gray!30!gray!15,
  colframe = Gray!50!black,
  coltitle = white,
  fonttitle = \bfseries,
  boxrule = 0pt,
  leftrule = 3pt,
  left = 2pt,
  right = 2pt,
  title = {Source code~\thetcbcounter : #3 \hfill \large\faCode},
  list entry = Source code~\thetcbcounter : #3,
  label = code:#4
}

% Configuration for SVG package.
\svgsetup{
  inkscapepath = Build/SVG/
}
\svgpath{Figures/SVGs/}

% Configuration for Lettrine.
\renewcommand{\LettrineFontHook}{\bfseries}
\setlength{\DefaultFindent}{.11em}
\setlength{\DefaultNindent}{.11em}
\LettrineRealHeighttrue

% Change ToC title name.
\addto\captionsenglish{
  \renewcommand{\contentsname}{Table of Contents}
  \renewcommand{\acronymname}{List of Acronyms} % TODO change theses?
  \renewcommand{\indexname}{Alphabetical Index}
}

% Cite configuration.
\newcommand{\myCite}[1]{\citeauthor*{#1} \cite{#1}\footfullcite{#1}}
\newcommand{\quoteAuthor}[1]{\citeauthor*{#1} \cite{#1}}

% Website domain command.
\newcommand{\myWeb}{51.75.163.95}

% Show copyright note source for floats.
\newcommand{\source}[1]{
  \vspace{-1em}\caption*{\footnotesize\hfill{#1}}
}

% Custom reference to chapter.
\newcommand{\chapRef}[1]{%
This \namecref{#1}, entitled \texttt{\nameref*{#1}}, begins on page~\pageref{#1}.
}

% Some basic math definitions.
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\loss}{\mathcal{L}}

% Basic math operators.
\DeclareMathOperator*{\argmin}{arg\,min}

% Custom commands.
\newcommand*{\re}[1]{\texttt{#1}}
\newcommand*{\code}[1]{\texttt{#1}}

\title{An innecesarily long title related to Artifical Intelligence and in the
  topic of Multimodal Learning}
\newcommand{\shortTitle}{Referring Expression Comprehension}
\author{David √Ålvarez Rosa}
\date{\today}


\includeonly{Chapters/Chapter6}
% \includeonly{Appendices/AppendixA}