% -*- TeX-master: "Thesis.tex" -*-


\RequirePackage[l2tabu, orthodox]{nag}
\documentclass[11pt]{book}


\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage{fix-cm}
\usepackage[main=english, spanish, catalan]{babel}
\usepackage{geometry}
\usepackage{amsmath, amsthm, amssymb}
\usepackage{bm}
\usepackage{graphicx}
\usepackage[cmyk, dvipsnames, table]{xcolor}
\usepackage{microtype}
\usepackage{emptypage}
\usepackage{fancyhdr}
\usepackage{lettrine}
\usepackage{booktabs}
\usepackage{caption}
\usepackage[nottoc]{tocbibind}
\usepackage[symbol*, bottom, marginal, norule]{footmisc}
\usepackage[type={CC}, modifier={by-nc-sa}, version={4.0}]{doclicense}
\usepackage[backend=biber, style=alphabetic, citestyle=alphabetic]{biblatex}
\usepackage{imakeidx}
\usepackage{epigraph}
\usepackage{tikz}
\usepackage{fontawesome}
\usepackage[outputdir=Build, cachedir=Minted]{minted}
\usepackage[most]{tcolorbox}
\usepackage[shadow]{todonotes}
\usepackage{hyperxmp}
\usepackage[pdfusetitle]{hyperref}
\usepackage[toc, acronym, nomain]{glossaries}


% Fallback to computer modern for sc + bf.
\rmfamily
\DeclareFontShape{T1}{lmr}{b}{sc}{<->ssub*cmr/bx/sc}{}
\DeclareFontShape{T1}{lmr}{bx}{sc}{<->ssub*cmr/bx/sc}{}

% % Customize page layout.
\geometry{
  paper = b5paper,
  top = 1in,
  bottom = .875in,
  inner = .75in,
  outer = .75in,
  bindingoffset = .25in,
  % showframe
}

% Customize captions for floating elements.
\captionsetup{
  font = small,
  labelfont = {sc, bf},
  labelsep = period,
  width = .75\textwidth,
  tableposition = top,
}

\hypersetup{
  % Info.
  pdfsubject = {Computer Vision},
  pdfkeywords = {Artificial Intelligence, Machine Learning, Computer Vision,
    Multimodal Learning},
  % Colors.
  colorlinks,
  % hidelinks,
  linkcolor = blue,
  citecolor = magenta,
  urlcolor = red!50!black,
  % For ToC.
  % linktoc = all,
  % Displaying.
  pdfpagelayout = TwoPageRight,
  pdfstartview = FitV,
  pdfpagemode = UseOutlines,
  bookmarksopen,
  bookmarksnumbered,
  breaklinks,
  % Write both PDF Info dictionary and XMP packet (from hyperxmp package).
  keeppdfinfo
}

% Configure running headers and footers.
\pagestyle{fancy}
\fancyhead[RO,LE]{\small\bfseries\thepage}
\fancyhead[RE]{\small\slshape\leftmark}
\fancyhead[LO]{\small\slshape\rightmark}
\fancyfoot{}
\makeatletter
\fancyfoot[CO]{\scshape\@author}
\fancyfoot[CE]{\scshape\@title}
\fancyfoot[CE]{\scshape A short version of Title related to Artificial Intelligence}
\makeatother
\renewcommand{\footrulewidth}{.4pt}
\fancypagestyle{plain}{
  \fancyhf{}
  \fancyfoot[C]{\small\thepage}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}
% Really ugly stuff.
% https://tex.stackexchange.com/questions/125457/changing-chapter-page-footer-with-epigraph
\makeatletter
\renewcommand{\epigraphhead}[2][95]{%
  \def\@epitemp{\begin{minipage}{\epigraphwidth}#2\end{minipage}}
  \def\ps@epigraph{\let\@mkboth\@gobbletwo
    \@epipos
    \if@epirhs
    \def\@oddhead{\hfil\begin{picture}(0,0)
        \put(0,-#1){\makebox(0,0)[r]{\@epitemp}}
      \end{picture}}
    \else
    \if@epicenter
    \def\@oddhead{\hfil\begin{picture}(0,0)
        \put(0,-#1){\makebox(0,0)[b]{\@epitemp}}
      \end{picture}\hfil}
    \else
    \def\@oddhead{\begin{picture}(0,0)
        \put(0,-#1){\makebox(0,0)[l]{\@epitemp}}
      \end{picture}\hfil}
    \fi
    \fi
    \let\@evenhead\@oddhead
    \def\@oddfoot{\reset@font\hfil\small\thepage\hfil}
    \let\@evenfoot\@oddfoot}
  \thispagestyle{epigraph}}
\makeatother
% Set path for figures (relative to main document).
\graphicspath{{./Figures/}}

% Glosary configuration.
\makeglossaries
\input{Acronyms}

% Alphabetical index customization.
\makeindex[columns=2, intoc, options={-s Index.ist}]

% Remove epigraph rule.
\setlength\epigraphrule{0pt}

% Set the label symbols (taken from spanish babel package).
\makeatletter
\renewcommand{\labelitemi}{%
  \leavevmode\hbox to 1.2ex{\hss\vrule height .9ex width .7ex depth -.2ex\hss}%
}
\renewcommand{\labelitemii}{\textbullet}
\renewcommand{\labelitemiii}{$\m@th\circ$}
\renewcommand{\labelitemiv}{$\m@th\diamond$}
\makeatother

% Add command for footnote href.
\newcommand\fhref[2]{
  \href{#1}{#2}\footnote{\url{#1}}
}

% Customize bibliography (biblatex and biber).
\addbibresource{References.bib}
\ExecuteBibliographyOptions{minnames=5, maxnames=5}
\DeclareFieldFormat{annotation}{\par\nobreak\vskip\bibitemsep #1\smallskip}
\renewbibmacro*{finentry}{\printfield{annotation}\finentry}
\DeclareFieldFormat{labelalpha}{\mkbibbold{#1}}
\DeclareFieldFormat{extraalpha}{\mkbibbold{\mknumalph{#1}}}

% Set minted style and font for line numbers.
\usemintedstyle{tango}
\renewcommand{\theFancyVerbLine}{
  \ttfamily\scriptsize\arabic{FancyVerbLine}
}

% Tikz configuration.
\usetikzlibrary{
  external,
  positioning,
  arrows,
  shadows.blur,
  calc,
  shapes.geometric
}
\tikzexternalize[prefix=Build/Tikz/, figure name=Figure]
\tikzset{
  linum/.style = {
    fill = black!25,
    draw = black
  },
  codeSymbol/.style = {
    white,
    circle,
    anchor = north east,
    outer sep = -9pt,
    fill = black,
  },
  quoteDecoration/.style = {
    draw = tcbcolframe,
    fill = tcbcolback!80!black,
    line width = .5mm,
  }
}

% Tcolorbox configuration.
\tcbuselibrary{listings}
\tcbuselibrary{minted}
% Basic reusable styles.
\tcbset{
  skipBox/.style = {
    before skip = .75em,
    after skip = 1em,
  },
  base/.style = {

  }
}
\tcbsetforeverylayer{shield externalize}
% Quote box.
\newtcolorbox{quoteBox}[1][]{
  skipBox,
  enhanced,
  lower separated = false,
  left = 3mm,
  right = 4mm,
  top = 1mm,
  bottom = 2mm,
  middle = 0pt,
  colback = RoyalBlue!10,
  colframe = RoyalBlue!50!black,
  sharp corners,
  rounded corners = southeast,
  arc is angular,
  arc = 3mm,
  leftrule = 5pt,
  underlay = {
    \path[quoteDecoration] ([shift={(.01, .3)}]interior.south east) --
    ++(-.4, -.1) -- ++(.1, -.2);
  },
  drop fuzzy shadow,
  #1
}
% Basic remark box.
\newtcbtheorem[no counter]{hola}{}{
  skipBox,
  lower separated = false,
  colframe = black,
  fonttitle = \bfseries,
  separator sign = {},
  coltitle = black,
  enhanced,
  top = 4.5mm,
  drop fuzzy shadow,
  boxed title style = { colframe = black },
  attach boxed title to top left = { xshift = 5mm, yshift = -2mm },
  colback = ForestGreen!12,
  colbacktitle = ForestGreen!36
  % colback = RoyalBlue!12,
  % colbacktitle = RoyalBlue!36
}{hola}
% Input code file.
\newtcbinputlisting[auto counter, number within=chapter, list inside=code]{\codeLst}[4]{
  listing engine = minted,
  minted language = #1,
  listing file = {#2},
  minted options = {
    autogobble,
    linenos,
    numbersep = 8pt,
    breaklines,
    % breaksymbol = {},
    fontfamily = tt,
    fontsize = \footnotesize,
    mathescape = true,
    samepage = false,
  },
  enhanced,
  listing only,
  drop fuzzy shadow,
  breakable,
  sharp corners,
  colbacktitle = green!50!black,
  colback = green!30!gray!15,
  colframe = green!50!black,
  coltitle = white,
  fonttitle = \bfseries,
  boxrule = 0pt,
  leftrule = 3pt,
  left = 2pt,
  right = 2pt,
  title = {Source code~\thetcbcounter : #3 \hfill \large\faCode},
  list entry = Source code~\thetcbcounter : #3,
  label = code:#4
}

% Todonotes configuration (disable externalization).
\setuptodonotes{inline}
\makeatletter
\renewcommand{\todo}[2][]{\tikzexternaldisable\@todo[#1]{#2}\tikzexternalenable}
\renewcommand{\missingfigure}[2][]{
  \tikzexternaldisable\@missingfigure[#1]{#2}\tikzexternalenable
}
\makeatother

% Some basic math definitions.
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\R}{\mathbb{R}}


\title{An innecesarily long title related to Artifical Intelligence and in the
  topic of Multimodal Learning}
\author{David √Ålvarez Rosa}
\date{\today}


\includeonly{Chapters/Chapter2}
