% -*- TeX-master: "../Thesis.tex" -*-


\RequirePackage[l2tabu, orthodox]{nag}
\documentclass[11pt]{book}


\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[main=english, spanish, catalan]{babel}
\usepackage{geometry}
\usepackage{amsmath, amsthm, amssymb, mathtools, bm}
\usepackage[cmyk, dvipsnames, table]{xcolor}
\usepackage{graphicx, float, svg}
\usepackage{microtype, emptypage, fancyhdr, lettrine, epigraph, everypage}
\usepackage[absolute]{textpos}
\usepackage{booktabs, caption, subcaption}
\usepackage[nottoc]{tocbibind}
\usepackage[bottom, marginal, norule]{footmisc}
\usepackage[type={CC}, modifier={by-nc-sa}, version={4.0}]{doclicense}
\usepackage[backend=biber, style=alphabetic]{biblatex}
\usepackage{imakeidx}
\usepackage{siunitx, eurosym, chemformula}
\usepackage{tikz, pgfplots, pgfgantt, pgfornament}
\usepackage{fontawesome}
\usepackage[outputdir=Build, cachedir=Minted]{minted}
\usepackage[most]{tcolorbox}
\usepackage{hyperxmp}
\usepackage{varioref}
\usepackage[pdfusetitle]{hyperref}
\usepackage[nomain, acronym]{glossaries}
\usepackage{glossary-longbooktabs}
\usepackage[noabbrev, capitalize]{cleveref}


% Customize page layout.
\geometry{
  layout = b5paper,
  paper = b5paper,
  top = 1in,
  bottom = .875in,
  inner = .75in,
  outer = .75in,
  bindingoffset = .25in,
  % showframe
  % paper = a4paper,
  % showcrop
}

% Customize captions for floating elements.
\captionsetup{
  font = small,
  labelfont = bf,
  labelsep = period,
}

\hypersetup{
  % Info.
  pdfsubject = {Computer Vision}, pdfkeywords = {Referring Expression
    Comprehension, Artificial Intelligence, Machine Learning, Deep Learning,
    Computer Vision, Natural Language Processing, Multimodal Learning},
  % Links.
  hidelinks,
  linktoc = all,
  % Displaying.
  pdfpagelayout = TwoPageRight,
  pdfstartview = FitV,
  pdfpagemode = UseOutlines,
  bookmarksopen,
  bookmarksnumbered,
  breaklinks,
  % Write both PDF Info dictionary and XMP packet (from hyperxmp package).
  keeppdfinfo,
}

% Configure running headers and footers.
\pagestyle{fancy}
\fancyhead[RO,LE]{\small\bfseries\thepage}
\fancyhead[RE]{\small\slshape\leftmark}
\fancyhead[LO]{\small\slshape\rightmark}
\fancyfoot{}
\fancyfoot[CO]{\small DAVID ÁLVAREZ ROSA}
\fancyfoot[CE]{\small REFERRING EXPRESSION COMPREHENSION}
\renewcommand{\footrulewidth}{.4pt}
\fancypagestyle{plain}{
  \fancyhf{}
  \fancyfoot[C]{\small\thepage}
  \renewcommand{\headrulewidth}{0pt}
  \renewcommand{\footrulewidth}{0pt}
}
% Really ugly stuff.
% https://tex.stackexchange.com/questions/125457/changing-chapter-page-footer-with-epigraph
\makeatletter
\renewcommand{\epigraphhead}[2][95]{%
  \def\@epitemp{\begin{minipage}{\epigraphwidth}#2\end{minipage}}
  \def\ps@epigraph{\let\@mkboth\@gobbletwo
    \@epipos
    \if@epirhs
    \def\@oddhead{\hfil\begin{picture}(0,0)
        \put(0,-#1){\makebox(0,0)[r]{\@epitemp}}
      \end{picture}}
    \else
    \if@epicenter
    \def\@oddhead{\hfil\begin{picture}(0,0)
        \put(0,-#1){\makebox(0,0)[b]{\@epitemp}}
      \end{picture}\hfil}
    \else
    \def\@oddhead{\begin{picture}(0,0)
        \put(0,-#1){\makebox(0,0)[l]{\@epitemp}}
      \end{picture}\hfil}
    \fi
    \fi
    \let\@evenhead\@oddhead
    \def\@oddfoot{\reset@font\hfil\small\thepage\hfil}
    \let\@evenfoot\@oddfoot}
  \thispagestyle{epigraph}}
\makeatother

% Set path for figures (relative to main document).
\graphicspath{{./Figures/}}

% Glosary configuration.
\setupglossaries{
  toc,
  shortcuts,
  ucmark,
  nogroupskip
}
% \setacronymstyle{long-sm-short}
\setglossarystyle{longragged3col-booktabs}
\makeglossaries
\input{Utils/Acronyms}
\renewcommand{\glsnamefont}[1]{\textbf{#1}}
\setlength\glspagelistwidth{.175\textwidth}
\setlength\glsdescwidth{.45\textwidth}
\preto\chapter{\glsresetall}

% Alphabetical index customization.
\makeindex[columns=2, intoc, options={-s Utils/Index.ist}]

% Epigraph configuration.
\setlength\epigraphwidth{.55\textwidth}
\renewcommand{\textflush}{flushright}
\setlength\epigraphrule{0pt}

% Set the label symbols (taken from spanish babel package).
\makeatletter
\renewcommand{\labelitemi}{%
  \leavevmode\hbox to 1.2ex{\hss\vrule height .9ex width .7ex depth -.2ex\hss}%
}
\renewcommand{\labelitemii}{\textbullet}
\renewcommand{\labelitemiii}{$\m@th\circ$}
\renewcommand{\labelitemiv}{$\m@th\diamond$}
\makeatother

% Define color for alternating rows in tables.
\colorlet{rowColor}{gray!10}

% Add command for footnote href.
\newcommand*\fhref[2]{%
  \href{#1}{#2}\footnote{Full link for ``#2'': \url{#1}}%
}

% Customize bibliography (biblatex and biber).
\addbibresource{Utils/References.bib}
\ExecuteBibliographyOptions{
  maxbibnames = 100,
  maxcitenames = 5,
  mincitenames = 5
}
\DeclareFieldFormat{annotation}{\par\nobreak\vskip\bibitemsep #1\smallskip}
\renewbibmacro*{finentry}{\printfield{annotation}\finentry}
\DeclareFieldFormat{labelalphawidth}{\mkbibbold{#1}}
% \DeclareFieldFormat{labelalphawidth}{\mkbibbrackets{\mkbibbold{#1}}}
\renewcommand{\mkbibnamefamily}[1]{\textsc{#1}}
% \renewcommand{\mkbibnamegiven}[1]{\textsc{#1}}
% \renewcommand{\mkbibnameprefix}[1]{\textsc{#1}}
% \renewcommand{\mkbibnamesuffix}[1]{\textsc{#1}}
\DeclareBibliographyCategory{text}
\DeclareBibliographyCategory{quote}
\DeclareBibliographyCategory{figure}

% Set minted style and font for line numbers.
\usemintedstyle{tango}
\renewcommand{\theFancyVerbLine}{
  \ttfamily\scriptsize\arabic{FancyVerbLine}
}

% Tikz configuration.
\usetikzlibrary{
  external,
  positioning,
  fit,
  backgrounds,
  arrows,
  shadows.blur,
  calc,
  shapes.geometric
}
\tikzexternalize[prefix=Build/Tikz/, figure name=Figure]
\tikzset{
  linum/.style = {
    fill = black!25,
    draw = black
  },
  codeSymbol/.style = {
    white,
    circle,
    anchor = north east,
    outer sep = -9pt,
    fill = black,
  },
  quoteDecoration/.style = {
    draw = tcbcolframe,
    fill = tcbcolback!80!black,
    line width = .5mm,
  },
  myPlot/.style = {
    smooth,
    ultra thick,
    blue,
    samples = 200
  }
}

% Pgfplots configuration.
\pgfplotsset{compat=newest}
\usepgfplotslibrary{external}
\pgfplotsset{%
  activationFunction/.style = {%
    xlabel = {$x$}, ylabel = {$y$},
    legend style = {
      at = {(0.5, 1.05)},
      anchor = south,
    },
    grid = both,
    xtick distance = 1, ytick distance = 1,
    minor tick num = 1,
    major grid style = {thin, dashed, gray!60},
    minor grid style = {thin, dashed, gray!20},
    axis lines = center,
    axis line style = {
      very thick,
      -latex
    },
    enlargelimits,
    width = \textwidth,
    scale only axis,
  },
  trainPlot/.style = {
    width = \textwidth,
    grid = major,
    grid style = {dashed, gray!40},
    xlabel = Epoch,
    ylabel = Loss function,
    thick,
    legend pos = north east
  }
}

% Tcolorbox configuration.
\tcbuselibrary{listings}
\tcbuselibrary{minted}
% Basic reusable styles.
\tcbset{
  indentFix/.style = {
    before upper={\parindent17pt\noindent}
  },
  baseBox/.style = {
    indentFix,
    enhanced,
    lower separated = false,
    breakable,
    boxrule = 0.5mm,
    boxsep = 0pt,
    left = \parindent-0.5mm,
    right = \parindent-0.5mm,
    bottom = 3mm,
    top = 3mm,
    middle = 1mm,
    colback = #1!7.5,
    colframe = #1!60!black,
    sharp corners,
    drop fuzzy shadow,
    rounded corners = southeast,
    arc is angular,
    arc = 3mm,
    underlay unbroken and last = {
      \path[quoteDecoration] ([shift={(.01, .3)}]interior.south east) --
      ++(-.4, -.1) -- ++(.1, -.2);
    },
  }
}
\tcbsetforeverylayer{shield externalize}
% Quote box.
\newtcolorbox{quoteBox}{
  baseBox = RoyalBlue,
  fontupper=\itshape,
  fontlower=\small,
  before lower = \hfill---,
  leftrule = 5pt,
  left = \parindent-5pt,
}
% Example box.
\newtcolorbox{exampleBox}{
  baseBox = OliveGreen,
}
% Remark box.
\newtcolorbox{remarkBox}{
  baseBox = Red,
  underlay = {
    \path[fill=tcbcolframe] ([shift={(-0.5mm,-0.5mm)}]interior.south west)
    rectangle node[white]{\Huge\bfseries !}
    ([shift={(3.5mm,0.5mm)}]interior.north west);
    }
}

% Input code file.
\tcbset{
  listing engine = minted
}
\newtcbinputlisting[auto counter]{\codeIn}[3][]{
  listing only,
  minted language = #2,
  listing file = {#3},
  minted options = {
    fontsize = \footnotesize,
    #1
  },
  baseBox = Gray,
  left = 5pt,
  top = 0pt,
  bottom = 0pt,
}

% Gantt chart colors.
\definecolor{blueGantt}{HTML}{0066FF}
\definecolor{greenGantt}{HTML}{33CC33}
\definecolor{yellowGantt}{HTML}{FFFFCC}

% Configuration for SVG package.
\svgsetup{
  inkscapepath = Build/SVG/
}
\svgpath{Figures/}

% Configuration for Lettrine.
\renewcommand{\LettrineFontHook}{\bfseries}
\setlength{\DefaultFindent}{.12em}
\setlength{\DefaultNindent}{.12em}
\renewcommand*{\DefaultLhang}{0.04}
\LettrineRealHeighttrue

% Change ToC title name.
\addto\captionsenglish{
  \renewcommand{\contentsname}{Table of Contents}
  \renewcommand{\acronymname}{List of Acronyms}
  \renewcommand{\indexname}{Alphabetical Index}
}

% Configuration for tables.
\renewcommand{\arraystretch}{1.25}

% Cite configuration.
\newcommand*{\myCite}[1]{%
  \citeauthor*{#1} \cite{#1}\footfullcite{#1}\addtocategory{text}{#1}%
}
\newcommand*{\quotecite}[1]{%
  \citeauthor*{#1} \cite{#1}\addtocategory{quote}{#1}%
}
\newcommand*{\figcite}[1]{%
  \citetitle*{#1}, by \citeauthor*{#1} \cite{#1}\addtocategory{figure}{#1}%
}

% Website domain command.
\newcommand{\myWeb}{51.75.163.95}

% Show copyright note source for floats.
\newcommand{\source}[1]{
  \vspace{-1em}\caption*{\footnotesize\hfill{#1}}
}

% Custom reference to chapter.
\newcommand{\chapRef}[1]{%
This \namecref{#1}, entitled \textsl{\nameref*{#1}}, begins on page~\pageref{#1}.
}

% Don't be afraid. Trust me, this *must* be done:
%   well-known mathematical constants typesetted where they belong,
%   and nice meme features added for pages 42 and 69 (just for the fun).
\makeatletter
\AddEverypageHook{%
  \if@mainmatter%
  \ifnum\value{page} = 1 % Page 2.
  \begin{textblock*}{.65cm}[0, .5](.05\paperwidth, .414213562373095\paperheight)
    \noindent\resizebox{.65cm}{!}{\(\sqrt{2}\)}
  \end{textblock*}
  \begin{textblock*}{.45cm}[0, .5](.05\paperwidth, .618033988749894\paperheight)
    \noindent\resizebox{.45cm}{!}{\(\varphi\)}
  \end{textblock*}
  \fi
  \ifnum\value{page} = 2 % Page 3.
  \begin{textblock*}{.65cm}[1, .5](.95\paperwidth, .23606797749978\paperheight)
    \noindent\resizebox{.65cm}{!}{\(\sqrt{5}\)}
  \end{textblock*}
  \begin{textblock*}{.4cm}[1, .5](.95\paperwidth, .718281828459045\paperheight)
    \noindent\resizebox{.4cm}{!}{\(e\)}
  \end{textblock*}
  \fi
  \ifnum\value{page} = 3 % Page 4.
  \begin{textblock*}{.5cm}[0, .5](.05\paperwidth, .141592653589793\paperheight)
    \noindent\resizebox{.5cm}{!}{\(\pi\)}
  \end{textblock*}
  \fi
  \ifnum\value{page} = 41 % Page 42.
  \begin{textblock*}{0pt}[0, 1](1pt, 1pt)
    \noindent\scalebox{0.000000000000001}{\textcolor{white}{blowjob}}
  \end{textblock*}
  \fi
  \ifnum\value{page} = 68 % Page 69.
  \begin{textblock*}{0pt}[0, 1](1pt, 1pt)
    \noindent\scalebox{0.000000000000001}{\textcolor{white}{kamasutra}}
  \end{textblock*}
  \fi
  \fi
}
\makeatother

% Some basic math definitions.
\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\loss}{\mathcal{L}}

% Basic math operators.
\DeclareMathOperator*{\argmin}{arg\,min}

% Create custom units.
\DeclareSIUnit\ects{\text{crédito \gls*{ects}}}
\DeclareSIUnit\ectss{\text{créditos \gls*{ects}}}

% Custom commands.
\newcommand*{\re}[1]{\texttt{#1}}
\newcommand*{\code}[1]{\texttt{#1}}

\title{Exploring and Visualizing Referring Expression Comprehension}
\author{David Álvarez Rosa}
\date{\today}


% \includeonly{Chapters/Chapter2}
% \includeonly{Appendices/AppendixC}
% \includeonly{FrontBack/FrontMatter}